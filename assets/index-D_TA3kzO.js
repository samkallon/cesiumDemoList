const J="tsParticles - Error",c={x:0,y:0,z:0},K=2,q=2,Q=1,U=0;var F;(function(e){e.bottom="bottom",e.bottomLeft="bottom-left",e.bottomRight="bottom-right",e.left="left",e.none="none",e.right="right",e.top="top",e.topLeft="top-left",e.topRight="top-right",e.outside="outside",e.inside="inside"})(F||(F={}));function g(e){return typeof e=="number"}class a{constructor(t,i,n){if(this._updateFromAngle=(s,o)=>{this.x=Math.cos(s)*o,this.y=Math.sin(s)*o},!g(t)&&t){this.x=t.x,this.y=t.y;const s=t;this.z=s.z?s.z:c.z}else if(t!==void 0&&i!==void 0)this.x=t,this.y=i,this.z=n??c.z;else throw new Error(`${J} Vector3d not initialized correctly`)}static get origin(){return a.create(c.x,c.y,c.z)}get angle(){return Math.atan2(this.y,this.x)}set angle(t){this._updateFromAngle(t,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(t){this._updateFromAngle(this.angle,t)}static clone(t){return a.create(t.x,t.y,t.z)}static create(t,i,n){return new a(t,i,n)}add(t){return a.create(this.x+t.x,this.y+t.y,this.z+t.z)}addTo(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}copy(){return a.clone(this)}distanceTo(t){return this.sub(t).length}distanceToSq(t){return this.sub(t).getLengthSq()}div(t){return a.create(this.x/t,this.y/t,this.z/t)}divTo(t){this.x/=t,this.y/=t,this.z/=t}getLengthSq(){return this.x**q+this.y**q}mult(t){return a.create(this.x*t,this.y*t,this.z*t)}multTo(t){this.x*=t,this.y*=t,this.z*=t}normalize(){const t=this.length;t!=U&&this.multTo(Q/t)}rotate(t){return a.create(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t),c.z)}setTo(t){this.x=t.x,this.y=t.y;const i=t;this.z=i.z?i.z:c.z}sub(t){return a.create(this.x-t.x,this.y-t.y,this.z-t.z)}subFrom(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}}class d extends a{constructor(t,i){super(t,i,c.z)}static get origin(){return d.create(c.x,c.y)}static clone(t){return d.create(t.x,t.y)}static create(t,i){return new d(t,i)}}let W=Math.random;function X(){return A(W(),0,1-Number.EPSILON)}function A(e,t,i){return Math.min(Math.max(e,t),i)}function Y(e){const t=C(e),i=0;let n=Z(e);return t===n&&(n=i),X()*(t-n)+n}function m(e){return g(e)?e:Y(e)}function Z(e){return g(e)?e:e.min}function C(e){return g(e)?e:e.max}function $(e,t){const i=e.x-t.x,n=e.y-t.y,s=2;return{dx:i,dy:n,distance:Math.sqrt(i**s+n**s)}}function D(e,t){return $(e,t).distance}function S(e,t,i,n){return d.create(e.x*(i-n)/(i+n)+t.x*K*n/(i+n),e.y)}var w;(function(e){e.auto="auto",e.increase="increase",e.decrease="decrease",e.random="random"})(w||(w={}));var M;(function(e){e.increasing="increasing",e.decreasing="decreasing"})(M||(M={}));var k;(function(e){e.none="none",e.max="max",e.min="min"})(k||(k={}));var E;(function(e){e.bottom="bottom",e.left="left",e.right="right",e.top="top"})(E||(E={}));var L;(function(e){e.precise="precise",e.percent="percent"})(L||(L={}));var T;(function(e){e.max="max",e.min="min",e.random="random"})(T||(T={}));function I(e){return{position:e.getPosition(),radius:e.getRadius(),mass:e.getMass(),velocity:e.velocity,factor:d.create(m(e.options.bounce.horizontal.value),m(e.options.bounce.vertical.value))}}function V(e,t){const{x:i,y:n}=e.velocity.sub(t.velocity),[s,o]=[e.position,t.position],{dx:u,dy:r}=$(o,s);if(i*u+n*r<0)return;const l=-Math.atan2(r,u),f=e.mass,y=t.mass,z=e.velocity.rotate(l),R=t.velocity.rotate(l),G=S(z,R,f,y),H=S(R,z,f,y),P=G.rotate(-l),v=H.rotate(-l);e.velocity.x=P.x*e.factor.x,e.velocity.y=P.y*e.factor.y,t.velocity.x=v.x*t.factor.x,t.velocity.y=v.y*t.factor.y}var h;(function(e){e.absorb="absorb",e.bounce="bounce",e.destroy="destroy"})(h||(h={}));var b;(function(e){e.external="external",e.particles="particles"})(b||(b={}));class O{constructor(t){this.type=b.particles,this.container=t}}const _=.5,p=10,tt=0;function N(e,t,i,n,s,o){const u=A(e.options.collisions.absorb.speed*s.factor/p,tt,n);e.size.value+=u*_,i.size.value-=u,n<=o&&(i.size.value=0,i.destroy())}function et(e,t,i,n){const s=e.getRadius(),o=t.getRadius();s===void 0&&o!==void 0?e.destroy():s!==void 0&&o===void 0?t.destroy():s!==void 0&&o!==void 0&&(s>=o?N(e,s,t,o,i,n):N(t,o,e,s,i,n))}const B=e=>{e.collisionMaxSpeed===void 0&&(e.collisionMaxSpeed=m(e.options.collisions.maxSpeed)),e.velocity.length>e.collisionMaxSpeed&&(e.velocity.length=e.collisionMaxSpeed)};function j(e,t){V(I(e),I(t)),B(e),B(t)}function it(e,t){!e.unbreakable&&!t.unbreakable&&j(e,t),e.getRadius()===void 0&&t.getRadius()!==void 0?e.destroy():e.getRadius()!==void 0&&t.getRadius()===void 0?t.destroy():e.getRadius()!==void 0&&t.getRadius()!==void 0&&(e.getRadius()>=t.getRadius()?t:e).destroy()}function nt(e,t,i,n){switch(e.options.collisions.mode){case h.absorb:{et(e,t,i,n);break}case h.bounce:{j(e,t);break}case h.destroy:{it(e,t);break}}}const st=2;class ot extends O{constructor(t){super(t)}clear(){}init(){}interact(t,i){if(t.destroyed||t.spawning)return;const n=this.container,s=t.getPosition(),o=t.getRadius(),u=n.particles.quadTree.queryCircle(s,o*st);for(const r of u){if(t===r||!r.options.collisions.enable||t.options.collisions.mode!==r.options.collisions.mode||r.destroyed||r.spawning)continue;const x=r.getPosition(),l=r.getRadius();if(Math.abs(Math.round(s.z)-Math.round(x.z))>o+l)continue;const f=D(s,x),y=o+l;f>y||nt(t,r,i,n.retina.pixelRatio)}}isEnabled(t){return t.options.collisions.enable}reset(){}}async function rt(e,t=!0){e.checkVersion("3.8.1"),await e.addInteractor("particlesCollisions",i=>Promise.resolve(new ot(i)),t)}export{rt as loadParticlesCollisionsInteraction};
