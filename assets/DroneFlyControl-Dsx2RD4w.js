import{S as H}from"./index-DqJpl1j7.js";import{_ as N,o as z,c as Z,e as Q,b as Y}from"./index-Cz_mX-Ds.js";const j=""+new URL("djiRemoteControl-Cxwn3L_E.png",import.meta.url).href,q={class:"container"},J={__name:"DroneFlyControl",setup(X){let a=null,T,F;z(async()=>{const i=new H.samCzm({Cesium});i.initViewer({id:"cesiumContainer"}),a=i.viewer,a.clock.shouldAnimate=!0,a.scene.primitives.add(await Cesium.Cesium3DTileset.fromIonAssetId(354759));const e=Cesium.Cartesian3.fromDegrees(-71.06551256219049,42.35433157165339,120),u=await Cesium.IonResource.fromAssetId(3195351),s=new Cesium.HeadingPitchRoll,t=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(0),Cesium.Math.toRadians(90),0),r=new Cesium.HeadingPitchRange;T=D(a.scene.context),F=new Cesium.PerspectiveFrustum({fov:Cesium.Math.PI_OVER_THREE,aspectRatio:3/4,near:1,far:100});const n=new Cesium.FrustumOutlineGeometry({frustum:F,origin:new Cesium.Cartesian3,orientation:new Cesium.Quaternion.fromHeadingPitchRoll(t)}),v=new Cesium.GeometryInstance({geometry:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString("rgb(255,255,255)"))},id:"frustum"}),R=a.scene.primitives.add(new Cesium.Primitive({geometryInstances:v,appearance:new Cesium.PerInstanceColorAppearance({closed:!1,flat:!0}),asynchronous:!1})),l=a.canvas;l.setAttribute("tabindex","0"),l.addEventListener("click",function(){l.focus()}),l.focus();const d=a.scene,o=new Cesium.SampledPositionProperty;a.entities.add({position:o,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:10,resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.3,taperPower:.3,color:Cesium.Color.PALEGOLDENROD})}});const W=a.camera,L=d.screenSpaceCameraController;let S=0,c=0,h=0,C=0;const g=Cesium.Math.toRadians(3);let f=Cesium.Cartesian3.clone(e),p=new Cesium.Cartesian3,k=new Cesium.Cartesian3,I=new Cesium.Cartesian3;const E=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west");try{const x=await Cesium.Model.fromGltfAsync({url:u,modelMatrix:Cesium.Transforms.headingPitchRollToFixedFrame(f,s,Cesium.Ellipsoid.WGS84,E),minimumPixelSize:128}),m=d.primitives.add(x);let V=a.entities.add({point:{},position:new Cesium.CallbackProperty(()=>m.ready?m.boundingSphere.center:e,!1)});a.trackedEntity=V,m.readyEvent.addEventListener(()=>{S=2*Math.max(m.boundingSphere.radius,W.frustum.near),L.minimumZoomDistance=S*.5;const w=m.boundingSphere.center,A=Cesium.Math.toRadians(230),y=Cesium.Math.toRadians(-20);r.heading=A,r.pitch=y,r.range=S*50,W.lookAt(w,r)}),document.addEventListener("keydown",function(w){switch(w.code){case"ArrowDown":c=Math.max(c-=1,-10);break;case"ArrowUp":c=Math.min(c+=1,10);break;case"ArrowLeft":s.heading-=g,s.heading<-Cesium.Math.TWO_PI&&(s.heading+=Cesium.Math.TWO_PI),t.heading-=g,t.heading<-Cesium.Math.TWO_PI&&(t.heading+=Cesium.Math.TWO_PI);break;case"ArrowRight":s.heading+=g,s.heading>Cesium.Math.TWO_PI&&(s.heading-=Cesium.Math.TWO_PI),t.heading+=g,t.heading>Cesium.Math.TWO_PI&&(t.heading-=Cesium.Math.TWO_PI);break;case"KeyA":h=Math.min(h+=1,10);break;case"KeyD":h=Math.max(h-=1,-10);break;case"KeyW":C=Math.min(C+=1,10);break;case"KeyS":C=Math.max(C-=1,-10);break;case"KeyQ":t.pitch+=g,t.pitch>Cesium.Math.TWO_PI&&(t.pitch-=Cesium.Math.TWO_PI),console.log(t.pitch);break;case"KeyE":t.pitch-=g,t.pitch<-Cesium.Math.TWO_PI&&(t.pitch+=Cesium.Math.TWO_PI),console.log(t.pitch);break;default:}}),document.addEventListener("keyup",function(w){switch(w.code){case"ArrowDown":c=0;break;case"ArrowUp":c=0;break;case"KeyA":h=0;break;case"KeyD":h=0;break;case"KeyW":C=0;break;case"KeyS":C=0;break;default:}}),a.scene.preUpdate.addEventListener(function(w,A){p=Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_X,c/10,p),k=Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Y,h/10,k),I=Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Z,C/10,I),Cesium.Cartesian3.add(p,k,p),Cesium.Cartesian3.add(p,I,p),f=Cesium.Matrix4.multiplyByPoint(m.modelMatrix,p,f),Cesium.Transforms.headingPitchRollToFixedFrame(f,t,Cesium.Ellipsoid.WGS84,E,R.modelMatrix),o.addSample(Cesium.JulianDate.now(),f),Cesium.Transforms.headingPitchRollToFixedFrame(f,s,Cesium.Ellipsoid.WGS84,E,m.modelMatrix),m.ready;let y=new Cesium.Camera(a.scene);y.setView({destination:f,orientation:{heading:t.heading+Cesium.Math.toRadians(180),pitch:-t.pitch,roll:t.roll+Cesium.Math.toRadians(180)}}),y.frustum=new Cesium.PerspectiveFrustum({fov:Cesium.Math.PI_OVER_THREE,aspectRatio:1,near:10,far:3e3}),O(T,a.scene,y);let G=Cesium.Texture.fromFramebuffer({context:a.scene.context,framebuffer:T});G.type="sampler2D";let _=a.scene.context.drawingBufferWidth,P=a.scene.context.drawingBufferHeight,U=a.scene.context.readPixels({x:0,y:0,width:_,height:P,framebuffer:T}),b=document.getElementById("fboContent");b.width=_,b.height=P;let K=new ImageData(new Uint8ClampedArray(U),_,P),M=b.getContext("2d");M.putImageData(K,0,0,0,0,_,P),M.translate(0,P),M.scale(1,-1),M.drawImage(b,0,0),b.style.height="276px",b.style.width="503px"})}catch(x){console.log(`Error loading model: ${x}`)}a.scene.preRender.addEventListener(function(x,m){}),B()});function D(i){let e=i.drawingBufferWidth,u=i.drawingBufferHeight;return new Cesium.Framebuffer({context:i,colorTextures:[new Cesium.Texture({context:i,width:e,height:u,pixelFormat:Cesium.PixelFormat.RGBA})]})}function B(){const i=document.getElementById("remoteUI"),e=i.getContext("2d");function u(){e.strokeStyle="#ffffff",e.lineWidth=.5;const t=i.width/3,r=i.height/3;for(let n=1;n<3;n++)e.beginPath(),e.moveTo(0,n*r),e.lineTo(i.width,n*r),e.stroke();for(let n=1;n<3;n++)e.beginPath(),e.moveTo(n*t,0),e.lineTo(n*t,i.height),e.stroke()}function s(){e.strokeStyle="white",e.lineWidth=.5,e.beginPath(),e.moveTo(0,0),e.lineTo(i.width,i.height),e.stroke(),e.beginPath(),e.moveTo(i.width,0),e.lineTo(0,i.height),e.stroke()}u(),s()}function O(i,e,u){let s=e._defaultView.camera;e._defaultView.camera=u;const t=e._frameState,r=e.context,n=r.uniformState,v=e._defaultView;e._view=v,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected;const R=new Cesium.Cesium3DTilePassState({pass:Cesium.Cesium3DTilePass.RENDER});t.tilesetPassState=R;let l=Cesium.defaultValue(e.backgroundColor,Cesium.Color.BLACK);t.backgroundColor=l,n.update(t),e._computeCommandList.length=0,e._overlayCommandList.length=0;const d=v.viewport;d.x=0,d.y=0,d.width=r.drawingBufferWidth,d.height=r.drawingBufferHeight;const o=v.passState;o.framebuffer=i,o.blendingEnabled=void 0,o.scissorTest=void 0,o.viewport=Cesium.BoundingRectangle.clone(d,o.viewport),Cesium.defined(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(o,l),e.resolveFramebuffers(o),o.framebuffer=void 0,Cesium.defined(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),r.endFrame(),e.globe.show=!0,e._defaultView.camera=s}return(i,e)=>(Y(),Z("div",q,e[0]||(e[0]=[Q('<div id="cesiumContainer" data-v-cb67485b></div><div class="remote-control" data-v-cb67485b><img src="'+j+'" alt="" width="631" data-v-cb67485b><canvas class="fbo-content remote-ui" id="fboContent" data-v-cb67485b></canvas><canvas class="remote-ui" id="remoteUI" data-v-cb67485b></canvas><div class="tip" data-v-cb67485b>WASD控制上下和左右，上下左右控制前进和转向，QE控制无人机相机视角</div></div>',2)])))}},te=N(J,[["__scopeId","data-v-cb67485b"]]);export{te as default};
