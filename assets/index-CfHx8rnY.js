var y;(function(t){t.bottom="bottom",t.bottomLeft="bottom-left",t.bottomRight="bottom-right",t.left="left",t.none="none",t.right="right",t.top="top",t.topLeft="top-left",t.topRight="top-right",t.outside="outside",t.inside="inside"})(y||(y={}));function _(t){return typeof t=="number"}function x(t){return Array.isArray(t)}let $=Math.random;function C(){return z($(),0,1-Number.EPSILON)}function z(t,n,e){return Math.min(Math.max(t,n),e)}function R(t){return _(t)?t:t.max}var j;(function(t){t.auto="auto",t.increase="increase",t.decrease="decrease",t.random="random"})(j||(j={}));var b;(function(t){t.increasing="increasing",t.decreasing="decreasing"})(b||(b={}));var S;(function(t){t.none="none",t.max="max",t.min="min"})(S||(S={}));var w;(function(t){t.bottom="bottom",t.left="left",t.right="right",t.top="top"})(w||(w={}));var I;(function(t){t.precise="precise",t.percent="percent"})(I||(I={}));var v;(function(t){t.max="max",t.min="min",t.random="random"})(v||(v={}));function B(t,n){return t===n||x(n)&&n.indexOf(t)>-1}async function A(t,n){try{await document.fonts.load(`${n??"400"} 36px '${t??"Verdana"}'`)}catch{}}function F(t){return Math.floor(C()*t.length)}function K(t,n,e=!0){return t[n!==void 0&&e?n%t.length:F(t)]}function N(t,n){return x(t)?t.map((r,i)=>n(r,i)):n(t,0)}function T(t,n,e){return x(t)?K(t,n,e):t}function k(t,n){const{context:e,opacity:r}=t,i=.5,s=e.globalAlpha;if(!n)return;const o=n.width,f=o*i;e.globalAlpha=r,e.drawImage(n,-f,-f,o,o),e.globalAlpha=s}const g='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"',E=0;class L{constructor(){this.validTypes=["emoji"],this._emojiShapeDict=new Map}destroy(){for(const[n,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e==null||e.close()),this._emojiShapeDict.delete(n)}draw(n){const e=n.particle.emojiDataKey;if(!e)return;const r=this._emojiShapeDict.get(e);r&&k(n,r)}async init(n){const e=n.actualOptions,{validTypes:r}=this;if(!r.find(o=>B(o,e.particles.shape.type)))return;const i=[A(g)],s=r.map(o=>e.particles.shape.options[o]).find(o=>!!o);s&&N(s,o=>{o.font&&i.push(A(o.font))}),await Promise.all(i)}particleDestroy(n){n.emojiDataKey=void 0}particleInit(n,e){const i=e.shapeData;if(!(i!=null&&i.value))return;const s=T(i.value,e.randomIndexData);if(!s)return;const o=typeof s=="string"?{font:i.font??g,padding:i.padding??E,value:s}:{font:g,padding:E,...i,...s},f=o.font,u=o.value,d=`${u}_${f}`;if(this._emojiShapeDict.has(d)){e.emojiDataKey=d;return}const O=o.padding*2,p=R(e.size.value),m=p+O,l=m*2;let h;if(typeof OffscreenCanvas<"u"){const c=new OffscreenCanvas(l,l),a=c.getContext("2d");if(!a)return;a.font=`400 ${p*2}px ${f}`,a.textBaseline="middle",a.textAlign="center",a.fillText(u,m,m),h=c.transferToImageBitmap()}else{const c=document.createElement("canvas");c.width=l,c.height=l;const a=c.getContext("2d");if(!a)return;a.font=`400 ${p*2}px ${f}`,a.textBaseline="middle",a.textAlign="center",a.fillText(u,m,m),h=c}this._emojiShapeDict.set(d,h),e.emojiDataKey=d}}async function P(t,n=!0){t.checkVersion("3.8.1"),await t.addShape(new L,n)}export{P as loadEmojiShape};
