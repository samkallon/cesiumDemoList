const P="tsParticles - Error";var O;(function(e){e.bottom="bottom",e.bottomLeft="bottom-left",e.bottomRight="bottom-right",e.left="left",e.none="none",e.right="right",e.top="top",e.topLeft="top-left",e.topRight="top-right",e.outside="outside",e.inside="inside"})(O||(O={}));function Z(e){return e==null}var z;(function(e){e.auto="auto",e.increase="increase",e.decrease="decrease",e.random="random"})(z||(z={}));var D;(function(e){e.increasing="increasing",e.decreasing="decreasing"})(D||(D={}));var N;(function(e){e.none="none",e.max="max",e.min="min"})(N||(N={}));var S;(function(e){e.bottom="bottom",e.left="left",e.right="right",e.top="top"})(S||(S={}));var j;(function(e){e.precise="precise",e.percent="percent"})(j||(j={}));var G;(function(e){e.max="max",e.min="min",e.random="random"})(G||(G={}));const V={debug:console.debug,error:console.error,info:console.info,log:console.log,verbose:console.log,warning:console.warn};function J(){return V}function H(e,t){return`hsla(${e.h}, ${e.s}%, ${e.l}%, ${t??1})`}const M=0,ee=1,te=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function ne(e,t,n){const{svgData:a}=e;if(!a)return"";const r=H(t,n);if(a.includes("fill"))return a.replace(te,()=>r);const i=a.indexOf(">");return`${a.substring(M,i)} fill="${r}"${a.substring(i)}`}async function U(e){return new Promise(t=>{e.loading=!0;const n=new Image;e.element=n,n.addEventListener("load",()=>{e.loading=!1,t()}),n.addEventListener("error",()=>{e.element=void 0,e.error=!0,e.loading=!1,J().error(`${P} loading image: ${e.source}`),t()}),n.src=e.source})}async function oe(e){if(e.type!=="svg"){await U(e);return}e.loading=!0;const t=await fetch(e.source);t.ok?e.svgData=await t.text():(J().error(`${P} Image not found`),e.error=!0),e.loading=!1}function ie(e,t,n,a){var o;const r=ne(e,n,((o=a.opacity)==null?void 0:o.value)??ee),i={color:n,gif:t.gif,data:{...e,svgData:r},loaded:!1,ratio:t.width/t.height,replaceColor:t.replaceColor,source:t.src};return new Promise(l=>{const d=new Blob([r],{type:"image/svg+xml"}),g=URL||window.URL||window.webkitURL||window,c=g.createObjectURL(d),u=new Image;u.addEventListener("load",()=>{i.loaded=!0,i.element=u,l(i),g.revokeObjectURL(c)});const C=async()=>{g.revokeObjectURL(c);const y={...e,error:!1,loading:!0};await U(y),i.loaded=!0,i.element=y.element,l(i)};u.addEventListener("error",()=>void C()),u.src=c})}const A=[0,4,2,1],Q=[8,8,4,2];class ae{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t)}getString(t){const n=this.data.slice(this.pos,this.pos+t);return this.pos+=n.length,n.reduce((a,r)=>a+String.fromCharCode(r),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let t="",n=0;const a=0,r=0;do{n=this.data[this.pos++];for(let i=n;--i>=a;t+=String.fromCharCode(this.data[this.pos++]));}while(n!==r);return t}readSubBlocksBin(){let t=this.data[this.pos],n=0;const a=0,r=1;for(let o=0;t!==a;o+=t+r,t=this.data[this.pos+o])n+=t;const i=new Uint8Array(n);t=this.data[this.pos++];for(let o=0;t!==a;t=this.data[this.pos++])for(let l=t;--l>=a;i[o++]=this.data[this.pos++]);return i}skipSubBlocks(){for(const t=1,n=0;this.data[this.pos]!==n;this.pos+=this.data[this.pos]+t);this.pos++}}var b;(function(e){e[e.Replace=0]="Replace",e[e.Combine=1]="Combine",e[e.RestoreBackground=2]="RestoreBackground",e[e.RestorePrevious=3]="RestorePrevious",e[e.UndefinedA=4]="UndefinedA",e[e.UndefinedB=5]="UndefinedB",e[e.UndefinedC=6]="UndefinedC",e[e.UndefinedD=7]="UndefinedD"})(b||(b={}));var T;(function(e){e[e.Extension=33]="Extension",e[e.ApplicationExtension=255]="ApplicationExtension",e[e.GraphicsControlExtension=249]="GraphicsControlExtension",e[e.PlainTextExtension=1]="PlainTextExtension",e[e.CommentExtension=254]="CommentExtension",e[e.Image=44]="Image",e[e.EndOfFile=59]="EndOfFile"})(T||(T={}));const w={x:0,y:0},re=0,W=.5,se=0,q=0,F=0;function K(e,t){const n=[];for(let a=0;a<t;a++)n.push({r:e.data[e.pos],g:e.data[e.pos+1],b:e.data[e.pos+2]}),e.pos+=3;return n}function le(e,t,n,a){switch(e.nextByte()){case T.GraphicsControlExtension:{const r=t.frames[n(!1)];e.pos++;const i=e.nextByte();r.GCreserved=(i&224)>>>5,r.disposalMethod=(i&28)>>>2,r.userInputDelayFlag=(i&2)===2;const o=(i&1)===1;r.delayTime=e.nextTwoBytes()*10;const l=e.nextByte();o&&a(l),e.pos++;break}case T.ApplicationExtension:{e.pos++;const r={identifier:e.getString(8),authenticationCode:e.getString(3),data:e.readSubBlocksBin()};t.applicationExtensions.push(r);break}case T.CommentExtension:{t.comments.push([n(!1),e.readSubBlocks()]);break}case T.PlainTextExtension:{if(t.globalColorTable.length===0)throw new EvalError("plain text extension without global color table");e.pos++,t.frames[n(!1)].plainTextData={left:e.nextTwoBytes(),top:e.nextTwoBytes(),width:e.nextTwoBytes(),height:e.nextTwoBytes(),charSize:{width:e.nextTwoBytes(),height:e.nextTwoBytes()},foregroundColor:e.nextByte(),backgroundColor:e.nextByte(),text:e.readSubBlocks()};break}default:e.skipSubBlocks();break}}async function ce(e,t,n,a,r,i){const o=t.frames[a(!0)];o.left=e.nextTwoBytes(),o.top=e.nextTwoBytes(),o.width=e.nextTwoBytes(),o.height=e.nextTwoBytes();const l=e.nextByte(),d=(l&128)===128,g=(l&64)===64;o.sortFlag=(l&32)===32,o.reserved=(l&24)>>>3;const c=1<<(l&7)+1;d&&(o.localColorTable=K(e,c));const u=f=>{const{r:h,g:m,b:s}=(d?o.localColorTable:t.globalColorTable)[f];return f!==r(null)?{r:h,g:m,b:s,a:255}:{r:h,g:m,b:s,a:n?~~((h+m+s)/3):0}},C=(()=>{try{return new ImageData(o.width,o.height,{colorSpace:"srgb"})}catch(f){if(f instanceof DOMException&&f.name==="IndexSizeError")return null;throw f}})();if(C==null)throw new EvalError("GIF frame size is to large");const y=e.nextByte(),L=e.readSubBlocksBin(),x=1<<y,v=(f,h)=>{const m=f>>>3,s=f&7;return(L[m]+(L[m+1]<<8)+(L[m+2]<<16)&(1<<h)-1<<s)>>>s};if(g){for(let f=0,h=y+1,m=0,s=[[0]],I=0;I<4;I++)if(A[I]<o.height){let p=0,E=0,B=!1;for(;!B;){const R=f;if(f=v(m,h),m+=h+1,f===x){h=y+1,s.length=x+2;for(let k=0;k<s.length;k++)s[k]=k<x?[k]:[]}else{f>=s.length?s.push(s[R].concat(s[R][0])):R!==x&&s.push(s[R].concat(s[f][0]));for(const k of s[f]){const{r:$,g:_,b:X,a:Y}=u(k);C.data.set([$,_,X,Y],A[I]*o.width+Q[I]*E+p%(o.width*4)),p+=4}s.length===1<<h&&h<12&&h++}p===o.width*4*(E+1)&&(E++,A[I]+Q[I]*E>=o.height&&(B=!0))}}o.image=C,o.bitmap=await createImageBitmap(C)}else{let f=0,h=y+1,m=0,s=-4,I=!1;const p=[[0]];for(;!I;){const E=f;if(f=v(m,h),m+=h,f===x){h=y+1,p.length=x+2;for(let B=0;B<p.length;B++)p[B]=B<x?[B]:[]}else{if(f===x+1){I=!0;break}f>=p.length?p.push(p[E].concat(p[E][0])):E!==x&&p.push(p[E].concat(p[f][0]));for(const B of p[f]){const{r:R,g:k,b:$,a:_}=u(B);C.data.set([R,k,$,_],s+=4)}p.length>=1<<h&&h<12&&h++}}o.image=C,o.bitmap=await createImageBitmap(C)}}async function fe(e,t,n,a,r,i){switch(e.nextByte()){case T.EndOfFile:return!0;case T.Image:await ce(e,t,n,a,r);break;case T.Extension:le(e,t,a,r);break;default:throw new EvalError("undefined block found")}return!1}function ge(e){for(const t of e.applicationExtensions)if(t.identifier+t.authenticationCode==="NETSCAPE2.0")return t.data[1]+(t.data[2]<<8);return NaN}async function de(e,t,n){n||(n=!1);const a=await fetch(e);if(!a.ok&&a.status===404)throw new EvalError("file not found");const r=await a.arrayBuffer(),i={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},o=new ae(new Uint8ClampedArray(r));if(o.getString(6)!=="GIF89a")throw new Error("not a supported GIF file");i.width=o.nextTwoBytes(),i.height=o.nextTwoBytes();const l=o.nextByte(),d=(l&128)===128;i.colorRes=(l&112)>>>4,i.sortFlag=(l&8)===8;const g=1<<(l&7)+1,c=o.nextByte();i.pixelAspectRatio=o.nextByte(),i.pixelAspectRatio!==0&&(i.pixelAspectRatio=(i.pixelAspectRatio+15)/64),d&&(i.globalColorTable=K(o,g));const u=(()=>{try{return new ImageData(i.width,i.height,{colorSpace:"srgb"})}catch(s){if(s instanceof DOMException&&s.name==="IndexSizeError")return null;throw s}})();if(u==null)throw new Error("GIF frame size is to large");const{r:C,g:y,b:L}=i.globalColorTable[c];u.data.set(d?[C,y,L,255]:[0,0,0,0]);for(let s=4;s<u.data.length;s*=2)u.data.copyWithin(s,0,s);i.backgroundImage=u;let x=-1,v=!0,f=-1;const h=s=>(s&&(v=!0),x),m=s=>(s!=null&&(f=s),f);try{do v&&(i.frames.push({left:0,top:0,width:0,height:0,disposalMethod:b.Replace,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),x++,f=-1,v=!1);while(!await fe(o,i,n,h,m,t));i.frames.length--;for(const s of i.frames){if(s.userInputDelayFlag&&s.delayTime===0){i.totalTime=1/0;break}i.totalTime+=s.delayTime}return i}catch(s){throw s instanceof EvalError?new Error(`error while parsing frame ${x} "${s.message}"`):s}}function he(e){const{context:t,radius:n,particle:a,delta:r}=e,i=a.image;if(!(i!=null&&i.gifData)||!i.gif)return;const o=new OffscreenCanvas(i.gifData.width,i.gifData.height),l=o.getContext("2d");if(!l)throw new Error("could not create offscreen canvas context");l.imageSmoothingQuality="low",l.imageSmoothingEnabled=!1,l.clearRect(w.x,w.y,o.width,o.height),a.gifLoopCount===void 0&&(a.gifLoopCount=i.gifLoopCount??F);let d=a.gifFrame??re;const g={x:-i.gifData.width*W,y:-i.gifData.height*W},c=i.gifData.frames[d];if(a.gifTime===void 0&&(a.gifTime=se),!!c.bitmap){switch(t.scale(n/i.gifData.width,n/i.gifData.height),c.disposalMethod){case b.UndefinedA:case b.UndefinedB:case b.UndefinedC:case b.UndefinedD:case b.Replace:l.drawImage(c.bitmap,c.left,c.top),t.drawImage(o,g.x,g.y),l.clearRect(w.x,w.y,o.width,o.height);break;case b.Combine:l.drawImage(c.bitmap,c.left,c.top),t.drawImage(o,g.x,g.y);break;case b.RestoreBackground:l.drawImage(c.bitmap,c.left,c.top),t.drawImage(o,g.x,g.y),l.clearRect(w.x,w.y,o.width,o.height),i.gifData.globalColorTable.length?l.putImageData(i.gifData.backgroundImage,g.x,g.y):l.putImageData(i.gifData.frames[q].image,g.x+c.left,g.y+c.top);break;case b.RestorePrevious:{const u=l.getImageData(w.x,w.y,o.width,o.height);l.drawImage(c.bitmap,c.left,c.top),t.drawImage(o,g.x,g.y),l.clearRect(w.x,w.y,o.width,o.height),l.putImageData(u,w.x,w.y)}break}if(a.gifTime+=r.value,a.gifTime>c.delayTime){if(a.gifTime-=c.delayTime,++d>=i.gifData.frames.length){if(--a.gifLoopCount<=F)return;d=q,l.clearRect(w.x,w.y,o.width,o.height)}a.gifFrame=d}t.scale(i.gifData.width/n,i.gifData.height/n)}}async function ue(e){if(e.type!=="gif"){await U(e);return}e.loading=!0;try{e.gifData=await de(e.source),e.gifLoopCount=ge(e.gifData)??F,e.gifLoopCount||(e.gifLoopCount=1/0)}catch{e.error=!0}e.loading=!1}const pe=2,me=1,we=12,xe=1;class Ce{constructor(t){this.validTypes=["image","images"],this.loadImageShape=async n=>{if(!this._engine.loadImage)throw new Error(`${P} image shape not initialized`);await this._engine.loadImage({gif:n.gif,name:n.name,replaceColor:n.replaceColor??!1,src:n.src})},this._engine=t}addImage(t){this._engine.images||(this._engine.images=[]),this._engine.images.push(t)}draw(t){const{context:n,radius:a,particle:r,opacity:i}=t,o=r.image,l=o==null?void 0:o.element;if(o){if(n.globalAlpha=i,o.gif&&o.gifData)he(t);else if(l){const d=o.ratio,g={x:-a,y:-a},c=a*pe;n.drawImage(l,g.x,g.y,c,c/d)}n.globalAlpha=me}}getSidesCount(){return we}async init(t){const n=t.actualOptions;if(!(!n.preload||!this._engine.loadImage))for(const a of n.preload)await this._engine.loadImage(a)}loadShape(t){if(t.shape!=="image"&&t.shape!=="images")return;this._engine.images||(this._engine.images=[]);const n=t.shapeData;if(!n)return;this._engine.images.find(r=>r.name===n.name||r.source===n.src)||this.loadImageShape(n).then(()=>{this.loadShape(t)})}particleInit(t,n){if(n.shape!=="image"&&n.shape!=="images")return;this._engine.images||(this._engine.images=[]);const a=this._engine.images,r=n.shapeData;if(!r)return;const i=n.getFillColor(),o=a.find(d=>d.name===r.name||d.source===r.src);if(!o)return;const l=r.replaceColor??o.replaceColor;if(o.loading){setTimeout(()=>{this.particleInit(t,n)});return}(async()=>{let d;o.svgData&&i?d=await ie(o,r,i,n):d={color:i,data:o,element:o.element,gif:o.gif,gifData:o.gifData,gifLoopCount:o.gifLoopCount,loaded:!0,ratio:r.width&&r.height?r.width/r.height:o.ratio??xe,replaceColor:l,source:r.src},d.ratio||(d.ratio=1);const g=r.fill??n.shapeFill,c=r.close??n.shapeClose,u={image:d,fill:g,close:c};n.image=u.image,n.shapeFill=u.fill,n.shapeClose=u.close})()}}class be{constructor(){this.src="",this.gif=!1}load(t){Z(t)||(t.gif!==void 0&&(this.gif=t.gif),t.height!==void 0&&(this.height=t.height),t.name!==void 0&&(this.name=t.name),t.replaceColor!==void 0&&(this.replaceColor=t.replaceColor),t.src!==void 0&&(this.src=t.src),t.width!==void 0&&(this.width=t.width))}}class ye{constructor(t){this.id="imagePreloader",this._engine=t}async getPlugin(){return await Promise.resolve(),{}}loadOptions(t,n){if(!(n!=null&&n.preload))return;t.preload||(t.preload=[]);const a=t.preload;for(const r of n.preload){const i=a.find(o=>o.name===r.name||o.src===r.src);if(i)i.load(r);else{const o=new be;o.load(r),a.push(o)}}}needsPlugin(){return!0}}const Ie=3;function Be(e){e.loadImage||(e.loadImage=async t=>{if(!t.name&&!t.src)throw new Error(`${P} no image source provided`);if(e.images||(e.images=[]),!e.images.find(n=>n.name===t.name||n.source===t.src))try{const n={gif:t.gif??!1,name:t.name??t.src,source:t.src,type:t.src.substring(t.src.length-Ie),error:!1,loading:!0,replaceColor:t.replaceColor,ratio:t.width&&t.height?t.width/t.height:void 0};e.images.push(n);let a;t.gif?a=ue:a=t.replaceColor?oe:U,await a(n)}catch{throw new Error(`${P} ${t.name??t.src} not found`)}})}async function Ee(e,t=!0){e.checkVersion("3.8.1"),Be(e);const n=new ye(e);await e.addPlugin(n,t),await e.addShape(new Ce(e),t)}export{Ee as loadImageShape};
