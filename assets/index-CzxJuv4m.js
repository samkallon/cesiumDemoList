const ae="pointerleave",le="pointermove";const ce="random";var W;(function(t){t.bottom="bottom",t.bottomLeft="bottom-left",t.bottomRight="bottom-right",t.left="left",t.none="none",t.right="right",t.top="top",t.topLeft="top-left",t.topRight="top-right",t.outside="outside",t.inside="inside"})(W||(W={}));function R(t){return typeof t=="string"}function D(t){return typeof t=="number"}function g(t){return Array.isArray(t)}function C(t){return t==null}let be=Math.random;function ee(){return $(be(),0,1-Number.EPSILON)}function $(t,e,n){return Math.min(Math.max(t,e),n)}function B(t,e,n,i){return Math.floor((t*n+e*i)/(n+i))}function k(t){const e=v(t),n=0;let i=te(t);return e===i&&(i=n),ee()*(e-i)+i}function te(t){return D(t)?t:t.min}function v(t){return D(t)?t:t.max}function S(t,e){if(t===e||e===void 0&&D(t))return t;const n=te(t),i=v(t);return e!==void 0?{min:Math.min(n,e),max:Math.max(i,e)}:S(n,i)}function fe(t,e){const n=t.x-e.x,i=t.y-e.y,o=2;return{dx:n,dy:i,distance:Math.sqrt(n**o+i**o)}}function F(t,e){return fe(t,e).distance}var A;(function(t){t.auto="auto",t.increase="increase",t.decrease="decrease",t.random="random"})(A||(A={}));var G;(function(t){t.increasing="increasing",t.decreasing="decreasing"})(G||(G={}));var J;(function(t){t.none="none",t.max="max",t.min="min"})(J||(J={}));var K;(function(t){t.bottom="bottom",t.left="left",t.right="right",t.top="top"})(K||(K={}));var Q;(function(t){t.precise="precise",t.percent="percent"})(Q||(Q={}));var U;(function(t){t.max="max",t.min="min",t.random="random"})(U||(U={}));function de(t,e){const n=E(e,i=>t.matches(i));return g(n)?n.some(i=>i):n}function O(t,e){return t===e||g(e)&&e.indexOf(t)>-1}function he(t){return Math.floor(ee()*t.length)}function L(t,e,n=!0){return t[he(t)]}function xe(t,e){return!!ie(e,n=>n.enable&&O(t,n.mode))}function pe(t,e,n){E(e,i=>{const o=i.mode;i.enable&&O(t,o)&&me(i,n)})}function me(t,e){const n=t.selectors;E(n,i=>{e(i,t)})}function ge(t,e){if(!(!e||!t))return ie(t,n=>de(e,n.selectors))}function E(t,e){return g(t)?t.map((i,o)=>e(i,o)):e(t,0)}function Me(t,e,n){return g(t)?L(t,e,n):t}function ie(t,e){return g(t)?t.find((i,o)=>e(i,o)):e(t,0)?t:void 0}function ye(t,e){if(e){for(const n of t.colorManagers.values())if(e.startsWith(n.stringPrefix))return n.parseString(e)}}function ne(t,e,n,i=!0){if(!e)return;const o=R(e)?{value:e}:e;if(R(o.value))return oe(t,o.value,n,i);if(g(o.value))return ne(t,{value:L(o.value,n,i)});for(const r of t.colorManagers.values()){const s=r.handleRangeColor(o);if(s)return s}}function oe(t,e,n,i=!0){if(!e)return;const o=R(e)?{value:e}:e;if(R(o.value))return o.value===ce?ze():Oe(t,o.value);if(g(o.value))return oe(t,{value:L(o.value,n,i)});for(const r of t.colorManagers.values()){const s=r.handleColor(o);if(s)return s}}function ve(t,e,n,i=!0){const o=ne(t,e,n,i);return o?re(o):void 0}function re(t){const e=t.r/255,n=t.g/255,i=t.b/255,o=Math.max(e,n,i),r=Math.min(e,n,i),s={h:0,l:(o+r)*.5,s:0};return o!==r&&(s.s=s.l<.5?(o-r)/(o+r):(o-r)/(2-o-r),s.h=e===o?(n-i)/(o-r):s.h=n===o?2+(i-e)/(o-r):2*2+(e-n)/(o-r)),s.l*=100,s.s*=100,s.h*=60,s.h<0&&(s.h+=360),s.h>=360&&(s.h-=360),s}function Oe(t,e){return ye(t,e)}function V(t){const e=(t.h%360+360)%360,n=Math.max(0,Math.min(100,t.s)),i=Math.max(0,Math.min(100,t.l)),o=e/360,r=n/100,s=i/100;if(n===0){const d=Math.round(s*255);return{r:d,g:d,b:d}}const u=(d,p,b)=>(b<0&&b++,b>1&&b--,b*6<1?d+(p-d)*6*b:b*2<1?p:b*3<1*2?d+(p-d)*(.6666666666666666-b)*6:d),a=s<.5?s*(1+r):s+r-s*r,f=2*s-a,l=1/3,c=Math.min(255,255*u(f,a,o+l)),h=Math.min(255,255*u(f,a,o)),x=Math.min(255,255*u(f,a,o-l));return{r:Math.round(c),g:Math.round(h),b:Math.round(x)}}function ze(t){return{b:Math.floor(k(S(0,256))),g:Math.floor(k(S(0,256))),r:Math.floor(k(S(0,256)))}}function Re(t,e,n,i){let o=t,r=e;return o.r===void 0&&(o=V(t)),r.r===void 0&&(r=V(e)),{b:B(o.b,r.b,n,i),g:B(o.g,r.g,n,i),r:B(o.r,r.r,n,i)}}class j{constructor(){this.value=""}static create(e,n){const i=new j;return i.load(e),n!==void 0&&(R(n)||g(n)?i.load({value:n}):i.load(n)),i}load(e){C(e)||C(e.value)||(this.value=e.value)}}var N;(function(t){t.circle="circle",t.rectangle="rectangle"})(N||(N={}));var H;(function(t){t.external="external",t.particles="particles"})(H||(H={}));var z;(function(t){t.circle="circle",t.rectangle="rectangle"})(z||(z={}));class se{constructor(e,n,i){this.position={x:e,y:n},this.type=i}}class q extends se{constructor(e,n,i){super(e,n,z.circle),this.radius=i}contains(e){return F(e,this.position)<=this.radius}intersects(e){const n=this.position,i=e.position,o={x:Math.abs(i.x-n.x),y:Math.abs(i.y-n.y)},r=this.radius;if(e instanceof q||e.type===z.circle){const s=e,u=r+s.radius,a=Math.sqrt(o.x**2+o.y**2);return u>a}else if(e instanceof _||e.type===z.rectangle){const s=e,{width:u,height:a}=s.size;return Math.pow(o.x-u,2)+Math.pow(o.y-a,2)<=r**2||o.x<=r+u&&o.y<=r+a||o.x<=u||o.y<=a}return!1}}class _ extends se{constructor(e,n,i,o){super(e,n,z.rectangle),this.size={height:o,width:i}}contains(e){const n=this.size.width,i=this.size.height,o=this.position;return e.x>=o.x&&e.x<=o.x+n&&e.y>=o.y&&e.y<=o.y+i}intersects(e){if(e instanceof q)return e.intersects(this);const n=this.size.width,i=this.size.height,o=this.position,r=e.position,s=e instanceof _?e.size:{width:0,height:0},u=s.width,a=s.height;return r.x<o.x+n&&r.x+u>o.x&&r.y<o.y+i&&r.y+a>o.y}}class Ce{constructor(e){this.type=H.external,this.container=e}}class ue{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(e){if(!C(e)){if(e.distance!==void 0&&(this.distance=e.distance),e.duration!==void 0&&(this.duration=e.duration),e.mix!==void 0&&(this.mix=e.mix),e.opacity!==void 0&&(this.opacity=e.opacity),e.color!==void 0){const n=g(this.color)?void 0:this.color;this.color=E(e.color,i=>j.create(n,i))}e.size!==void 0&&(this.size=e.size)}}}class Ee extends ue{constructor(){super(),this.selectors=[]}load(e){super.load(e),!C(e)&&e.selectors!==void 0&&(this.selectors=e.selectors)}}class Se extends ue{load(e){super.load(e),!C(e)&&(this.divs=E(e.divs,n=>{const i=new Ee;return i.load(n),i}))}}var m;(function(t){t.color="color",t.opacity="opacity",t.size="size"})(m||(m={}));function X(t,e,n,i){if(e>=n){const o=t+(e-n)*i;return $(o,t,e)}else if(e<n){const o=t-(n-e)*i;return $(o,e,t)}}const y="bubble",T=0,qe=0,_e=2,Y=1,Z=1,we=0,Be=0,I=.5,P=1;class ke extends Ce{constructor(e,n){super(e),this._clickBubble=()=>{var l;const i=this.container,o=i.actualOptions,r=i.interactivity.mouse.clickPosition,s=o.interactivity.modes.bubble;if(!s||!r)return;i.bubble||(i.bubble={});const u=i.retina.bubbleModeDistance;if(!u||u<T)return;const a=i.particles.quadTree.queryCircle(r,u,c=>this.isEnabled(c)),{bubble:f}=i;for(const c of a){if(!f.clicking)continue;c.bubble.inRange=!f.durationEnd;const h=c.getPosition(),x=F(h,r),d=(new Date().getTime()-(i.interactivity.mouse.clickTime??qe))/1e3;d>s.duration&&(f.durationEnd=!0),d>s.duration*_e&&(f.clicking=!1,f.durationEnd=!1);const p={bubbleObj:{optValue:i.retina.bubbleModeSize,value:c.bubble.radius},particlesObj:{optValue:v(c.options.size.value)*i.retina.pixelRatio,value:c.size.value},type:m.size};this._process(c,x,d,p);const b={bubbleObj:{optValue:s.opacity,value:c.bubble.opacity},particlesObj:{optValue:v(c.options.opacity.value),value:((l=c.opacity)==null?void 0:l.value)??Y},type:m.opacity};this._process(c,x,d,b),!f.durationEnd&&x<=u?this._hoverBubbleColor(c,x):delete c.bubble.color}},this._hoverBubble=()=>{const i=this.container,o=i.interactivity.mouse.position,r=i.retina.bubbleModeDistance;if(!r||r<T||!o)return;const s=i.particles.quadTree.queryCircle(o,r,u=>this.isEnabled(u));for(const u of s){u.bubble.inRange=!0;const a=u.getPosition(),f=F(a,o),l=Z-f/r;f<=r?l>=Be&&i.interactivity.status===le&&(this._hoverBubbleSize(u,l),this._hoverBubbleOpacity(u,l),this._hoverBubbleColor(u,l)):this.reset(u),i.interactivity.status===ae&&this.reset(u)}},this._hoverBubbleColor=(i,o,r)=>{const s=this.container.actualOptions,u=r??s.interactivity.modes.bubble;if(u){if(!i.bubble.finalColor){const a=u.color;if(!a)return;const f=Me(a);i.bubble.finalColor=ve(this._engine,f)}if(i.bubble.finalColor)if(u.mix){i.bubble.color=void 0;const a=i.getFillColor();i.bubble.color=a?re(Re(a,i.bubble.finalColor,Z-o,o)):i.bubble.finalColor}else i.bubble.color=i.bubble.finalColor}},this._hoverBubbleOpacity=(i,o,r)=>{var h,x;const s=this.container,u=s.actualOptions,a=(r==null?void 0:r.opacity)??((h=u.interactivity.modes.bubble)==null?void 0:h.opacity);if(!a)return;const f=i.options.opacity.value,l=((x=i.opacity)==null?void 0:x.value)??Y,c=X(l,a,v(f),o);c!==void 0&&(i.bubble.opacity=c)},this._hoverBubbleSize=(i,o,r)=>{const s=this.container,u=r!=null&&r.size?r.size*s.retina.pixelRatio:s.retina.bubbleModeSize;if(u===void 0)return;const a=v(i.options.size.value)*s.retina.pixelRatio,f=i.size.value,l=X(f,u,a,o);l!==void 0&&(i.bubble.radius=l)},this._process=(i,o,r,s)=>{const u=this.container,a=s.bubbleObj.optValue,f=u.actualOptions,l=f.interactivity.modes.bubble;if(!l||a===void 0)return;const c=l.duration,h=u.retina.bubbleModeDistance,x=s.particlesObj.optValue,d=s.bubbleObj.value,p=s.particlesObj.value??we,b=s.type;if(!(!h||h<T||a===x))if(u.bubble||(u.bubble={}),u.bubble.durationEnd)d&&(b===m.size&&delete i.bubble.radius,b===m.opacity&&delete i.bubble.opacity);else if(o<=h){if((d??p)!==a){const M=p-r*(p-a)/c;b===m.size&&(i.bubble.radius=M),b===m.opacity&&(i.bubble.opacity=M)}}else b===m.size&&delete i.bubble.radius,b===m.opacity&&delete i.bubble.opacity},this._singleSelectorHover=(i,o,r)=>{const s=this.container,u=document.querySelectorAll(o),a=s.actualOptions.interactivity.modes.bubble;!a||!u.length||u.forEach(f=>{const l=f,c=s.retina.pixelRatio,h={x:(l.offsetLeft+l.offsetWidth*I)*c,y:(l.offsetTop+l.offsetHeight*I)*c},x=l.offsetWidth*I*c,d=r.type===N.circle?new q(h.x,h.y,x):new _(l.offsetLeft*c,l.offsetTop*c,l.offsetWidth*c,l.offsetHeight*c),p=s.particles.quadTree.query(d,b=>this.isEnabled(b));for(const b of p){if(!d.contains(b.getPosition()))continue;b.bubble.inRange=!0;const w=a.divs,M=ge(w,l);(!b.bubble.div||b.bubble.div!==l)&&(this.clear(b,i,!0),b.bubble.div=l),this._hoverBubbleSize(b,P,M),this._hoverBubbleOpacity(b,P,M),this._hoverBubbleColor(b,P,M)}})},this._engine=n,e.bubble||(e.bubble={}),this.handleClickMode=i=>{i===y&&(e.bubble||(e.bubble={}),e.bubble.clicking=!0)}}clear(e,n,i){e.bubble.inRange&&!i||(delete e.bubble.div,delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}init(){const e=this.container,n=e.actualOptions.interactivity.modes.bubble;n&&(e.retina.bubbleModeDistance=n.distance*e.retina.pixelRatio,n.size!==void 0&&(e.retina.bubbleModeSize=n.size*e.retina.pixelRatio))}interact(e){const n=this.container.actualOptions,i=n.interactivity.events,o=i.onHover,r=i.onClick,s=o.enable,u=o.mode,a=r.enable,f=r.mode,l=i.onDiv;s&&O(y,u)?this._hoverBubble():a&&O(y,f)?this._clickBubble():pe(y,l,(c,h)=>this._singleSelectorHover(e,c,h))}isEnabled(e){const n=this.container,i=n.actualOptions,o=n.interactivity.mouse,r=((e==null?void 0:e.interactivity)??i.interactivity).events,{onClick:s,onDiv:u,onHover:a}=r,f=xe(y,u);return f||a.enable&&o.position||s.enable&&o.clickPosition?O(y,a.mode)||O(y,s.mode)||f:!1}loadModeOptions(e,...n){e.bubble||(e.bubble=new Se);for(const i of n)e.bubble.load(i==null?void 0:i.bubble)}reset(e){e.bubble.inRange=!1}}async function Ie(t,e=!0){t.checkVersion("3.8.1"),await t.addInteractor("externalBubble",n=>Promise.resolve(new ke(n,t)),e)}export{Se as Bubble,ue as BubbleBase,Ee as BubbleDiv,Ie as loadExternalBubbleInteraction};
